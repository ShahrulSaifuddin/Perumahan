---
phase: 3
plan: 3.2
wave: 1
---

# Plan 3.2: Complaint Details & Workflow

## Objective

Implement the detailed view for a complaint, including status updates and a comment thread.

## Context

- `SPEC.md` (Status flow: OPEN -> IN_REVIEW -> ... -> CLOSED).
- `RESEARCH.md` (Schema: `complaint_comments`).

## Tasks

<task type="auto">
  <name>Implement Details & Comments API</name>
  <files>
    server/actions/complaints.ts
    lib/api/complaints.ts
  </files>
  <action>
    - `getComplaintDetails(id)`: Fetch single complaint + comments + author profile.
    - `updateComplaintStatus(id, status)`: DBKL/Leader only.
    - `addComment(complaintId, content)`: Add comment to thread.
  </action>
</task>

<task type="auto">
  <name>Implement Details UI</name>
  <files>
    features/complaints/complaint-details.tsx
    features/complaints/status-select.tsx
    features/complaints/comment-section.tsx
    app/complaints/[id]/page.tsx
  </files>
  <action>
    - `/complaints/[id]`: Page showing details.
    - `StatusSelect`: Dropdown to change status (if authorized).
    - `CommentSection`: List comments + Form to add new one.
  </action>
  <verify>
    - Open a complaint.
    - DBKL Officer changes status to IN_REVIEW.
    - Resident sees status update.
    - Resident adds comment "Any update?".
    - Officer sees comment.
  </verify>
</task>

## Success Criteria

- [ ] Status updates work and persist.
- [ ] Comments can be added and viewed.
- [ ] RLS protects unauthorized access.
