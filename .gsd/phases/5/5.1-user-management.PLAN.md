# Plan 5.1: User Management (Gap Closure)

**Goal**: Implement a User Management interface under "Settings" to allow Admins (DBKL/Leaders) to register and manage system users.

## 5.1.1 Feature: User Registration

An Admin interface to create new users with specific roles (Resident, Finance, etc.) and assign them to properties.

- **UI Location**: `/settings/users` and `/settings/users/new`.
- **Roles Allowed**:
  - `DBKL_SUPER_ADMIN`: Can create any user.
  - `DBKL_OFFICER`: Can create Flat Leaders/Residents.
  - `FLAT_LEADER`: Can create Residents/Finance Officers for their property.
- **Logic**:
  - Use `supabaseAdmin` (Service Role) to create `auth.users` entry.
  - Insert into `public.profiles`.
  - (Optional) Send Invite Email via Resend.

## 5.1.2 Feature: Dashboard Stats (Polish Gap)

Refine the Dashboard to show real counts instead of placeholders, closing the gap from Phase 4 verification.

## Implementation Steps

1.  **Environment Setup**:
    - Add `SUPABASE_SERVICE_ROLE_KEY` to `.env.local` (Required for Admin User creation).
    - Create `lib/supabase/admin.ts`.
2.  **Server Actions**:
    - `createUser(formData)`: Validates role permissions, calls Admin API, creates Profile.
3.  **UI Components**:
    - `UserList`: Table of users with search/filter.
    - `UserForm`: Fields for Email, Name, Role, Property.
4.  **Page**:
    - `app/settings/users/page.tsx`
    - `app/settings/users/new/page.tsx`

## Verification Plan

1.  **Manual Test**:
    - Log in as Super Admin.
    - Go to Settings -> Users -> Create New.
    - Create a "Resident".
    - Verify user exists in Supabase Auth and Profiles table.
    - Try logging in as the new user.
