---
phase: 8
plan: flat-management
wave: 1
---

# Feature: Flat/Apartment Management (Settings)

## Goal

Allow Super Admins to Create, Edit, and Delete properties (flats/apartments) via the Settings section.

## User Story

As a **Super Admin**, I want to manage the list of properties so that I can onboard new flats or update existing ones.

## Proposed Changes

### 1. Settings Layout & Navigation

- **New Layout**: `app/(protected)/settings/layout.tsx`
  - Introduce a "Settings Nav" (Tabs or Side-menu).
  - Items: "Users", "Properties".
- **Redirect**: `app/(protected)/settings/page.tsx` -> Redirects to `/settings/users`.
- **Sidebar**: Update main Sidebar "Settings" link to `/settings`.

### 2. Properties Management Page

- **Page**: `app/(protected)/settings/properties/page.tsx`
  - Check Role: `DBKL_SUPER_ADMIN` only? (Or viewable by others, editable by Super Admin? The user said "only super admin allow to do that". I'll restrict _edit_ actions to Super Admin, or maybe the whole page).
  - _Decision_: Restrict the whole "Properties" tab to Super Admin for simplicity, or just disable buttons. The user said "only super admin allow to do that". I will start by restricting the actions.
- **Components**:
  - `features/settings/properties/property-list.tsx`: Table/List of properties.
  - `features/settings/properties/property-upsert-dialog.tsx`: Create/Edit form.
  - `features/settings/properties/property-delete-dialog.tsx`: Delete confirmation.

### 3. Server Actions

- **File**: `server/actions/properties.ts`
- **Functions**:
  - `createProperty(data: { name: string, address: string })`
  - `updateProperty(id: string, data: { name: string, address: string })`
  - `deleteProperty(id: string)`
  - **Security**: All actions MUST verify `DBKL_SUPER_ADMIN` role using `checkRole` or manual check.

## Detailed Steps

### Wave 1: Backend & Actions

- Create `server/actions/properties.ts`.
- Implement Zod schema for property validation.

### Wave 2: UI Implementation

- Create `app/(protected)/settings/layout.tsx` with navigation.
- Create `app/(protected)/settings/page.tsx` (redirect).
- Create `app/(protected)/settings/properties/page.tsx`.
- Implement Dialogs and List components in `features/settings/properties/...`.

## Verification Plan

### Manual

1.  **Super Admin Access**:
    - Log in as Super Admin.
    - Navigate to Settings -> Properties.
    - **Create**: Add "Test Flat". Verify appears in list.
    - **Edit**: Rename "Test Flat" to "Test Flat Updated". Verify change.
    - **Delete**: Delete "Test Flat Updated". Verify removed.
2.  **Role Restriction**:
    - Log in as Non-Super Admin (e.g., Resident).
    - Try to access `/settings/properties` (should be hidden or redirected).
    - At minimum, verified they cannot see the "Add" button or call the actions.
