---
phase: 2
plan: 2.2
wave: 1
---

# Plan 2.2: Transaction Management

## Objective

Implement full CRUD for Transactions (IN/OUT) and the Approval Workflow (Draft -> Submitted -> Approved/Rejected).

## Context

- `SPEC.md` (Roles: Finance Officer creates/edits Draft, Flat Leader approves).
- `RESEARCH.md` (Schema: `transactions` table).

## Tasks

<task type="auto">
  <name>Implement Transaction CRUD</name>
  <files>
    server/actions/transactions.ts
    features/finance/transaction-form.tsx
    features/finance/transaction-list.tsx
    app/finance/transactions/page.tsx
  </files>
  <action>
    - Server Action `createTransaction`: Input validation (zod), insert to DB (status: DRAFT).
    - Server Action `updateTransaction`: Only allowed if DRAFT.
    - Server Action `deleteTransaction`: Only allowed if DRAFT.
    - UI: List transactions with filters (Year, Type, Status).
  </action>
</task>

<task type="auto">
  <name>Implement Approval Workflow</name>
  <files>
    server/actions/transactions.ts
    features/finance/approval-actions.tsx
  </files>
  <action>
    - Server Action `submitTransaction`: DRAFT -> SUBMITTED (Finance Officer).
    - Server Action `approveTransaction`: SUBMITTED -> APPROVED (Flat Leader only). Decrects balance check?
    - Server Action `rejectTransaction`: SUBMITTED -> REJECTED (Flat Leader only).
    - UI: "Approve" / "Reject" buttons visible only to Flat Leader for SUBMITTED items.
  </action>
  <verify>
    - PO creates transaction -> Status DRAFT.
    - PO submits -> Status SUBMITTED.
    - Leader approves -> Status APPROVED.
    - Verify balance updates in Dashboard (from Plan 2.1).
  </verify>
</task>

## Success Criteria

- [ ] Finance Officer can create/edit DRAFTs.
- [ ] Flat Leader CANNOT edit, only Approve/Reject.
- [ ] Status transitions enforce role permissions.
