---
phase: 2
plan: 2.1
wave: 1
---

# Plan 2.1: Finance Dashboard & Allocation

## Objective

Implement the Finance Dashboard to display summary statistics (Total allocation, Remaining balance, Total expenditure) and manage Annual Allocations.

## Context

- `RESEARCH.md` (Schema for `finance_allocations`)
- `SPEC.md` (Finance Rules: RM 5,000 default, Balance calculation)

## Tasks

<task type="auto">
  <name>Implement Allocation Management</name>
  <files>
    lib/api/finance.ts
    server/actions/finance.ts
    components/finance/allocation-card.tsx
    app/finance/page.tsx
  </files>
  <action>
    Create server actions and UI to view/manage allocations.
    - `getFinanceOverview(propertyId, year)`: Returns allocation, approved expense sum, balance.
    - `ensureAllocation(propertyId, year)`: Checks if allocation exists, if not creates default (RM 5000).
    - UI: Display "Current Year Allocation" card with storage-like progress bar (Spent vs Limit).
  </action>
  <verify>
    - Manually trigger `ensureAllocation` for current year.
    - Check DB `finance_allocations` table for new record.
    - Verify UI shows "RM 5,000" and "RM 0.00" spent initially.
  </verify>
  <done>
    Users can see their property's financial standing.
  </done>
</task>

## Success Criteria

- [ ] Dashboard loads without error.
- [ ] Auto-creates allocation for 2026 if missing.
- [ ] Correctly calculates "Remaining Balance".
